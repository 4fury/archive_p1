# HG changeset patch
# User Wolfgang Rosenauer <wr@rosenauer.org>
# Parent 0d6917b8f28f6e0398dbf329dda4932ba4f997c2
Bug 583793 - Firefox interface language set to LANG, ignores LANGUAGE

diff -Nuar a/mozilla/intl/locale/src/nsLocaleService.cpp b/mozilla/intl/locale/src/nsLocaleService.cpp
--- a/mozilla/intl/locale/src/nsLocaleService.cpp	2013-08-02 00:48:45.000000000 +0300
+++ b/mozilla/intl/locale/src/nsLocaleService.cpp	2013-08-09 06:19:03.443348614 +0300
@@ -132,6 +132,7 @@
 #else
     // Get system configuration
     const char* lang = getenv("LANG");
+    const char* language = getenv("LANGUAGE");
 #endif
 
     nsAutoString xpLocale, platformLocale;
@@ -160,6 +161,11 @@
         if (NS_FAILED(result)) {
             return;
         }
+        // LANGUAGE is overriding LC_MESSAGES
+        if (i == LC_MESSAGES && language && *language) {
+          CopyASCIItoUTF16(language, platformLocale);
+          result = nsPosixLocale::GetXPLocale(language, xpLocale);
+        }
         resultLocale->AddCategory(category, xpLocale);
         resultLocale->AddCategory(category_platform, platformLocale);
     }
